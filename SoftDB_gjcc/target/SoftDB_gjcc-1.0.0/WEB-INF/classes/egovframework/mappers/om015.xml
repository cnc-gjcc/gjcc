<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="om015">
	   <resultMap id="boardSearchResult" type="map" >
	        <result property="COMM_CNTN" column="COMM_CNTN" jdbcType="CLOB" javaType="java.lang.String" />
	    </resultMap>
	
	<update id="deleteCntDB" parameterType="map">
		UPDATE om015
		SET
			USE_YN = #{use_yn}
			, mod_dt = to_char(sysdate, 'yyyymmdd')
			, mod_tm = to_char(sysdate, 'hh24miss')
			, mod_usr_id = #{mod_usr_id}
		WHERE
			TBBS_ID = #{tbbs_id}
	</update>
       
		<update id="updateReqRsn" parameterType="map">
			UPDATE om015
			SET	RE_MOD_REQ_RSN = #{req_rsn},
			CDB_ACT_ST_CD = '020300'
			WHERE REQ_ID = #{req_id}
		</update>
		
    <select id="selectVocCntDB" parameterType="map" resultType="map">
	    <!-- SELECT COUNT(1) AS ORG_VOCCNT, NVL(SUM(CASE WHEN AFFS_ORG_USR_ID = #{orgUsrId} THEN 1 ELSE 0 END),0) AS USR_VOCCNT -->
	    SELECT COUNT(1) AS ORG_VOCCNT, NVL(SUM(CASE WHEN ORG_USR_ID = #{orgUsrId} THEN 1 ELSE 0 END),0) AS USR_VOCCNT 
	    FROM om015 
        where 1=1  
	    AND USE_YN='Y' 
	    AND CDB_ACT_ST_CD NOT IN ('010100','020200','030100')
		AND ORG_ID = #{orgId}
    </select>

		
		<update id="processRegist" parameterType="map">
			UPDATE om015
				SET		tbbs_id = #{tbbs_id}
			WHERE REQ_ID = #{req_id}
		</update>
		
		<!-- <select id="select" parameterType="map" resultType="map"> -->
	    <select id="counselDbConfmDetail" parameterType="map" resultMap="boardSearchResult">
		select * 
	    from (SELECT tbbs_id
		, cntr_nm
		, team_nm
		, usr_id
		, usr_nm
		, tbbs_gb_cd
		, cdb_gb_cd
		, decode(CC_APPR_YN,'P','처리중','N','미승인','Y','승인') as ARR_YN
		, CC_APPR_YN
		, getCodeNM(cdb_gb_cd, '90303') AS CDB_GB_NM
		<!-- , DBMS_LOB.SUBSTR(tbbs_cont_c, 2000, 1) AS TBBS_CNTN -->
		, tbbs_cont_c AS COMM_CNTN
		, dtls
		, tbbs_ttl
		, tbbs_inqr_cnt
		, inst_cd
		, ctg_lg_cd AS INTV_LG_CD
		, ctg_md_cd AS INTV_MD_CD
		, ctg_sm_cd AS INTV_SM_CD
		, (
		(SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_lg_cd AND ctg_lvl = '1')
		|| (SELECT ' > ' || ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_md_cd AND ctg_lvl = '2')
		|| (SELECT ' > ' || ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_sm_cd AND ctg_lvl = '3')
		) AS intv_nm
		, (SELECT NVL(usr_nm,'') FROM om001 WHERE usr_id = A.RSPN_PRSN) AS respon_prsn
		, rspn_prsn
		, NVL(RSPN_TEL_NO,'') as respon_tel
		, use_yn
		, unuse_rsn AS NTUSE_DESC
		, NVL((select OU from om061 BB where bb.UID_ = A.CRT_USR_ID),getCodeNM((select CNTR_CD from om001 where USR_ID =A.CRT_USR_ID), '90002'))as CRT_USR_DEPT
		, NVL((select OU from om061 BB where bb.UID_ = A.MOD_USR_ID),getCodeNM((select CNTR_CD from om001 where USR_ID =A.MOD_USR_ID), '90002'))as MOD_USR_DEPT
		, NVL((select DISPLAYNAME from om061 BB where bb.UID_ = A.MOD_USR_ID),(select USR_NM from om001 where usr_id =A.MOD_USR_ID)) as MOD_USR_NM
		, NVL((select DISPLAYNAME from om061 BB where bb.UID_ = A.CRT_USR_ID),(select USR_NM from om001 where usr_id =A.CRT_USR_ID)) as CRT_USR_NM
		, getFormatDate(crt_dt) AS crt_dt_format
		, getFormatTime(crt_tm) AS crt_tm_format
		, crt_usr_id
		, getFormatDate(mod_dt) AS mod_dt_format
		, getFormatTime(mod_tm) AS mod_tm_format
		, mod_usr_id
		FROM oh013 A
		WHERE wrk_id = #{wrk_id}) cross join 
	                                                            (select CDB_REQ_GB_CD
	                                                            	  , ORG_USR_ID
	                                                            	  ,	getCodeNM(CDB_REQ_GB_CD, '90302') AS cdb_req_gb_nm
	                                                            	  , CDB_ACT_ST_CD
	                                                                  , getCodeNM(CDB_ACT_ST_CD, '90260') AS cdb_act_st_nm       
	                                                                  , RE_MOD_REQ_RSN                                                                                                                           
	                                                                  from om015  where req_id = #{req_id})
	    </select> 


		<select id="counselDbComfmManageList" parameterType="map" resultType="map"> 
	        <if test="rows != null and page != null">
	        SELECT *
	        FROM
	        (
	            SELECT A1.*
	                ,   CEIL((ROW_NUMBER() OVER(ORDER BY ROWNUM)) / #{rows}) PAGENUM
	                ,   CEIL(COUNT(1) OVER() / #{rows}) TOTPAGECOUNT
	                ,   CEIL(COUNT(1) OVER()) TOTROWCOUNT
	            FROM
	            (
	        	  </if>
	              select  NVL((select OU from om060 c where c.oucode=a.org_id),getCodeNM(a.org_id,'90002')) as dept_nm
	                     , decode(a.CDB_REQ_GB_CD,'010100','신규','020100','수정','030100','삭제') as requst
	                     , decode(a.CDB_ACT_ST_CD,'010100','접수','010105','부서접수','020100','처리중','030100','완료','010200','담당자지정','010400','담당자(재)지정','020200','반송','020300','재작성요청') as progrs   
	                     , decode(B.TBBS_TTL,'','등록된 게시물이 없습니다.',' ','등록이 완료되지 않았습니다.',B.TBBS_TTL) as TBBS_TTL
	                     , a.CDB_REQ_GB_CD
	                     , a.TBBS_ID
	                     , a.REQ_ID
	                     , NVL2(a.act_dt,(getFormatdate(a.act_dt)||' '||getFormatTime(a.act_tm)),'') as act_dttm
	                     , (getFormatdate(a.crt_dt)||' '||getFormatTime(a.crt_tm)) as crt_dttm
	                     , (getFormatdate(a.mod_dt)||' '||getFormatTime(a.mod_tm)) as mod_dttm
	                     , B.CC_APPR_YN
	                     , B.WRK_ID
	                     , DECODE(B.CC_APPR_YN,'Y','승인','N','미승인',' ')  as CC_APPR_YN_NM
	                     <!-- from om015 A left join om010 B
	                     on A.TBBS_ID = B.TBBS_ID -->
	                     from om015 A left join oh013 B
	                     on A.REQ_ID = B.REQ_ID
	                     where 1 = 1
		       				<if test="srchStat != null and !srchStat.equals('all') and !srchStat.equals('')">
		        				and A.CDB_ACT_ST_CD = #{srchStat}
		        			</if>
		        			<!-- 	                     		        				                     
		       				<if test="ctg_ex_cd != null and !ctg_ex_cd.equals('all') and !ctg_ex_cd.equals('')">
		        				and A.CTG_EX_CD = #{ctg_ex_cd}
		        			</if>
		        			 -->
		        			<if test="ctg_lg_cd != null and !ctg_lg_cd.equals('all') and !ctg_lg_cd.equals('')">
		        				and A.CTG_LG_CD = #{ctg_lg_cd}
		        			</if>       			
		        			<if test="ctg_md_cd != null and !ctg_md_cd.equals('all') and !ctg_md_cd.equals('')">
		        				and A.CTG_MD_CD = #{ctg_md_cd}
		        			</if>
		        			<if test="ctg_sm_cd != null and !ctg_sm_cd.equals('all') and !ctg_sm_cd.equals('')">
		        				and A.CTG_SM_CD = #{ctg_sm_cd}
		        			</if>
		        			<if test="deptSe != null and !deptSe.equals('all') and !deptSe.equals('')">
		        				and A.ORG_ID = #{deptSe}
		        			</if>
		        			<if test="cc_appr_yn != null and !cc_appr_yn.equals('all') and !cc_appr_yn.equals('')">
		        				and B.CC_APPR_YN = #{cc_appr_yn}
		        			</if>
		        		   <if test="srchVal != null and !srchVal.equals('') and !srchVal.equals('')">
		           				and B.TBBS_TTL LIKE '%' || #{srchVal} || '%'
		            	   </if>
		            	   <!-- hhs 20.03.23 삭제처리에 대한 사용식별-->
		            	   and A.USE_YN = 'Y'
		        		   and A.CRT_DT between #{frDate} and #{toDate}
		        		  <!--  and A.CDB_ACT_ST_CD = '90263'  -->
	        <if test="sidx != null and sord != null">
               	 order by ${sidx} ${sord}
            </if>
	        <if test="rows != null and page != null">
	            ) A1
	        )
	        WHERE PAGENUM = #{page}
	        </if>
	    </select>


	    
       <select id="cnltStatisticsList"  parameterType="map" resultType="map">	
		<if test="rows != null and page != null">
		SELECT *
        FROM
        (
            SELECT A1.*
                ,   CEIL((ROW_NUMBER() OVER(ORDER BY ROWNUM)) / #{rows}) PAGENUM
                ,   CEIL(COUNT(1) OVER() / #{rows}) TOTPAGECOUNT
                ,   CEIL(COUNT(1) OVER()) TOTROWCOUNT
            FROM
            (
         </if>        
			select * from(
			select
			a.OUCODE
			<if test="checkboxYN != null and checkboxYN == false">
			,a.UID_ 
			,(select bb.displayname from om061 bb where bb.UID_ = a.UID_) as DISPLAYNAME 
			</if>
			,(select distinct cc.OU from om061 cc where cc.OUCODE = a.OUCODE) as OU 
			, SUM( (case when c.CDB_REQ_GB_CD='010100' then 1 else 0 end) +
			(case when c.CDB_REQ_GB_CD='020100' then 1 else 0 end) +
			(case when c.CDB_REQ_GB_CD='030100' then 1 else 0 end) +
			(case when c.CDB_ACT_ST_CD='010100' then 1 else 0 end) ) as TOT 
			, SUM(case when c.CDB_REQ_GB_CD='010100' then 1 else 0 end) as NEW_REQ 
			, SUM(case when c.CDB_REQ_GB_CD='020100' then 1 else 0 end) as MOD_REQ 
			, SUM(case when c.CDB_REQ_GB_CD='030100' then 1 else 0 end) as DEL_REQ 
			, SUM(case when c.CDB_ACT_ST_CD='020200' then 1 else 0 end) as RTN_REQ
			<!-- , SUM(
				(CASE WHEN c.cdb_req_gb_cd = '010100'   THEN 1 ELSE 0 END) + 
				(CASE WHEN c.cdb_req_gb_cd = '020100'   THEN 1 ELSE 0 END) + 
				(CASE WHEN c.cdb_req_gb_cd = '030100'   THEN 1 ELSE 0 END) + 
				(CASE WHEN c.cdb_act_st_cd = '010100'   THEN 1 ELSE 0 END)
				) - SUM(CASE WHEN c.cdb_act_st_cd = '020200'   THEN 1 ELSE 0 END) as FNS_REQ  -->
			, SUM(CASE WHEN c.cdb_act_st_cd = '030100' THEN 1 ELSE 0 END) AS fns_req
			from om061 a
			left join (select p.OUCODE from om060 p) <!--  where p.OULEVEL  <![CDATA[>=]]> 3 -->
			m on m.oucode = a.OUCODE 
			left join (select * from om015 where TO_DATE(crt_dt, 'YYYYMMDD') between TO_DATE(#{frDt}, 'YYYYMMDD')and TO_DATE(#{toDt}, 'YYYYMMDD')) c 
			on c.org_usr_id = a.UID_ and c.org_id =a.OUCODE 
			where 1=1 
			<!-- and a.CC_AFFAIRS_YN != 'Y'  -->
			and a.use_yn ='Y' 
			<if test="uid != null and !uid.equals('all') and !uid.equals('')">
			</if>
			<if test="oucode != null and !oucode.equals('all') and !oucode.equals('')">
				and a.OUCODE = #{oucode}
			</if>
			<if test="orgFulNm != null and !orgFulNm.equals('')">
				AND	a.ORGFULLNAME LIKE '%' || #{orgFulNm} || '%'
			</if>
			group by 
			<if test="checkboxYN != null and checkboxYN == false">
			a.UID_,
			</if> 
			a.OUCODE 
			order by a.OUCODE DESC
			) 
			where 1=1
			<if test="uid == null or uid.equals('') or uid.equals('all')">
				and TOT != 0
			</if>
			<if test="rows != null and page != null">
			) A1
				<if test="sidx != null and !sidx.equals('')">
				ORDER BY 
					${sidx} 
					<!-- <if test="checkboxYN != null and checkboxYN == false"> -->
					<if test="checkboxYN != null">
					${sord}
					</if>
				</if>
	        	) WHERE PAGENUM = #{page}
	        </if>
		</select>
       
		<select id="selectList" parameterType="map" resultType="map">
		<if test="rows != null and page != null">
        SELECT *
        FROM
        (
            SELECT A1.*
                ,   CEIL((ROW_NUMBER() OVER(ORDER BY ROWNUM)) / #{rows}) PAGENUM
                ,   CEIL(COUNT(1) OVER() / #{rows}) TOTPAGECOUNT
                ,   CEIL(COUNT(1) OVER()) TOTROWCOUNT
            FROM
            (
        	</if>
        			SELECT 	REQ_ID AS COMM_ID
        					,	TBBS_ID
        					,	USR_ID
        					,	CNTR_NM
        					,	TEAM_NM
        					,	USR_NM
        					,	ORG_USR_ID
        					,	AFFS_USR_NM
        					,   NVL((select OU from om061 where uid_= AFFS_ORG_USR_ID),getCodeNM((select cntr_cd from om001 where usr_id = AFFS_ORG_USR_ID),'90002')) as AFFS_DEPT_NM
        					,	NVL((SELECT DISPLAYNAME FROM OM061 B WHERE B.UID_ = A.ORG_USR_ID),(select usr_nm from om001 where usr_id = A.ORG_USR_ID)) AS ORG_USR_ID_NM
        					,	ORG_ID
        					<!-- ,	CTG_EX_CD AS INTV_EX_CD -->
        					,	CTG_LG_CD AS INTV_LG_CD
        					,	CTG_MD_CD AS INTV_MD_CD
        					,	CTG_SM_CD AS INTV_SM_CD
        					,	CDB_REQ_GB_CD AS CDB_GB_CD
        					<!-- 
                  			, 	(SELECT CTG_CD_NM FROM OM020 WHERE CTG_LVL = '1' AND CTG_CD = CTG_EX_CD) AS INTV_EX_NM
                  			, 	(SELECT CTG_CD_NM FROM OM020 WHERE CTG_LVL = '2' AND CTG_CD = CTG_LG_CD) AS INTV_LG_NM
                  			, 	(SELECT CTG_CD_NM FROM OM020 WHERE CTG_LVL = '3' AND PARNT_CD = CTG_LG_CD AND CTG_CD = CTG_MD_CD) AS INTV_MD_NM
                  			, 	(SELECT CTG_CD_NM FROM OM020 WHERE CTG_LVL = '4' AND PARNT_CD = CTG_MD_CD AND CTG_CD = CTG_SM_CD) AS INTV_SM_NM             
 							,	(SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_ex_cd AND ctg_lvl = '1')
								|| ' > ' || (SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_lg_cd AND ctg_lvl = '2') 
								|| ' > ' || (SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_md_cd AND ctg_lvl = '3')
								|| ' > ' || (SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_sm_cd AND ctg_lvl = '4')
							 -->	
							
                  			, 	(SELECT CTG_CD_NM FROM OM020 WHERE CTG_LVL = '1' AND CTG_CD = CTG_LG_CD) AS INTV_LG_NM
                  			, 	(SELECT CTG_CD_NM FROM OM020 WHERE CTG_LVL = '2' AND PARNT_CD = CTG_LG_CD AND CTG_CD = CTG_MD_CD) AS INTV_MD_NM
                  			, 	(SELECT CTG_CD_NM FROM OM020 WHERE CTG_LVL = '3' AND PARNT_CD = CTG_MD_CD AND CTG_CD = CTG_SM_CD) AS INTV_SM_NM             
 							,	(SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_lg_cd AND ctg_lvl = '1')								 
								|| ' > ' || (SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_md_cd AND ctg_lvl = '2')
								|| ' > ' || (SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_sm_cd AND ctg_lvl = '3')								
								 AS intv_nm
                  			, 	DBMS_LOB.SUBSTR(REQ_CONT_C, 100, 1) AS COMM_CNTN  /* 100자리까지만 조회 */
        					,	TBBS_TTL AS COMM_TTL
        					,	CDB_ACT_ST_CD AS PROG_KND_CD
        					,	(select sm.cd_nm from sm002 sm where sm.tp_cd = '90301' AND sm.cd = CDB_ACT_ST_CD) AS prog_knd_nm
        					,	ACT_CONT AS RESP_CNTN
        					,	USE_YN
                   			,	DECODE(CDB_REQ_GB_CD, '010100','신규','020100','수정','삭제')  AS COMM_NEW 
        					, 	getFormatdate(crt_dt)||' '||getFormatTime(crt_tm) AS crt_dttm
        					,	getFormatDate(crt_dt) AS crt_dt_format
        					,	getFormatTime(crt_tm) AS crt_tm_format
        					,	CRT_USR_ID
        					,   NVL2(a.act_dt,(getFormatdate(a.act_dt)||' '||getFormatTime(a.act_tm)),'') as act_dttm
        					, 	(SELECT USR_NM from om001 where usr_id = A.crt_usr_id) AS crt_usr_nm
        					, 	(getFormatdate(mod_dt)||' '||getFormatTime(mod_tm)) AS mod_dttm
        					,	(getFormatDate(mod_dt)) AS mod_dt_format
        					,	(getFormatTime(mod_tm)) AS mod_tm_format
        					,	(mod_usr_id) AS mod_usr_id
        					,	(SELECT USR_NM from om001 where usr_id = A.mod_usr_id) AS mod_usr_nm 
        			FROM om015 A
        			WHERE use_yn = 'Y'
        			<if test="srch_val != null and !srch_val.equals('')">
	            		<if test="srch_type.equals('ttl')">
	      					and upper(A.tbbs_ttl) LIKE '%' || #{srch_val}  || '%' 
	      				</if>
	      				<if test="srch_type.equals('cntn')">
	      					and DBMS_LOB.INSTR(A.REQ_CONT_C,#{srch_val})<![CDATA[ > 0 ]]>
	      				</if>
	      				<if test="srch_type.equals('ttlCntn')">
	      					 and ( upper(A.tbbs_ttl) LIKE '%' || #{srch_val}  || '%' OR DBMS_LOB.INSTR(A.REQ_CONT_C,#{srch_val})<![CDATA[ > 0 ]]>)
	      				</if>
           			</if>
        			<if test="jisikTtl != null and !jisikTtl.equals('')">
        				and upper(A.tbbs_ttl) LIKE '%' || #{jisikTtl}  || '%' 
        			</if> 
         			<if test="jisikTbbsId != null and !jisikTbbsId.equals('')">
        				and TBBS_ID = #{jisikTbbsId}
        			</if>
        			<!--        			
        			<if test="intv_ex_cd != null and !intv_ex_cd.equals('all')">
        				and CTG_EX_CD = #{intv_ex_cd}
        			</if>
        			 -->
        			<if test="intv_lg_cd != null and !intv_lg_cd.equals('all')">
        				and CTG_LG_CD = #{intv_lg_cd}
        			</if>       			
        			<if test="intv_md_cd != null and !intv_md_cd.equals('all')">
        				and CTG_MD_CD = #{intv_md_cd}
        			</if>
        			<if test="intv_sm_cd != null and !intv_sm_cd.equals('all')">
        				and CTG_SM_CD = #{intv_sm_cd}
        			</if>
        			<if test="cdb_gb_cd != null and !cdb_gb_cd.equals('all')">
        				and CDB_GB_CD = #{cdb_gb_cd}
        			</if>
        			<if test="new_yn != null and !new_yn.equals('all')">
        				and CDB_REQ_GB_CD = #{new_yn}
        			</if>
        			<if test="prog_knd_cd != null and !prog_knd_cd.equals('all')">        			
        				<if test="ccauth != null and !ccauth.equals('y')">
        				and CDB_ACT_ST_CD = #{prog_knd_cd}
        				</if>
        			</if>
        			<if test="prog_knd_cd != null and prog_knd_cd.equals('all') and cdbActStCds != null and !cdbActStCds.equals('all')">
        			and CDB_ACT_ST_CD IN
        			<foreach item="cdbActStCds" index="index" collection="cdbActStCds" open="(" separator="," close=")">
		          	#{cdbActStCds}
					</foreach>
        			</if>        			
        			<if test="frDt != null and !frDt.equals('') and toDt != null and !toDt.equals('')">
        			AND TO_DATE(crt_dt, 'YYYYMMDD') between TO_DATE(#{frDt}, 'YYYYMMDD') and TO_DATE(#{toDt}, 'YYYYMMDD')
        			</if>
        			<if test="!alldept">
        			<if test="sendingOuCode != null and !sendingOuCode.equals('')">
        				and org_id = #{sendingOuCode}
        			</if>
        			<if test="sendingUid != null and !sendingUid.equals('')">
        				and ORG_USR_ID = #{sendingUid}
        			</if>
        			</if>
        			<if test="usr_id != null and !usr_id.equals('all')">
        				and CRT_USR_ID = #{usr_id}
        			</if>
        	
        	<if test="sidx != null and sord != null">
                ORDER BY ${sidx} ${sord}
            </if>
            
             <if test="rows != null and page != null">
	            ) A1
	        )
	        WHERE PAGENUM = #{page}
        	</if>
		</select>
		
		<select id="select" parameterType="map" resultMap="boardSearchResult">
			SELECT 	REQ_ID AS COMM_ID
					,	TBBS_ID
					,	USR_ID
					,	CNTR_NM
					,	TEAM_NM
					,	USR_NM
					,   (SELECT DISPLAYNAME FROM OM061 B WHERE B.OUCODE = A.org_id and CC_AFFAIRS_YN='Y' and B.UID_ = A.org_usr_id) AS cc_aff
					,   NVL((SELECT ORGFULLNAME FROM OM061 B WHERE B.OUCODE = A.org_id  and B.UID_ = A.AFFS_ORG_USR_ID), getCodeNM((select cntr_cd from om001 where usr_id = AFFS_ORG_USR_ID),'90002')) AS DEPT_ID_NM
        			,	NVL((SELECT DISPLAYNAME FROM OM061 B WHERE B.UID_ = A.org_usr_id),(select usr_nm from om001 where usr_id = A.ORG_USR_ID)) AS ORG_USR_ID_NM	       			     			
					,	AFFS_ORG_USR_ID
					,   AFFS_USR_NM
	       			,	ORG_USR_ID			
        			,	ORG_ID
        			,	ACT_CONT
        			,   RTN_RSN
        			, 	AFFS_ORG_USR_ID
					<!-- ,	CTG_EX_CD AS INTV_EX_CD -->
					,	CTG_LG_CD AS INTV_LG_CD
					,	CTG_MD_CD AS INTV_MD_CD
					,	CTG_SM_CD AS INTV_SM_CD
					,	cdb_gb_cd
					,	REQ_CONT_C AS COMM_CNTN
					,	ACT_CONT AS RESP_CNTN
					,	TBBS_TTL AS COMM_TTL
					,	CDB_ACT_ST_CD AS PROG_KND_CD
					,	USE_YN
					,	CDB_REQ_GB_CD as NEW_YN
					, 	decode(getFormatdate(crt_dt),'','',(getFormatdate(crt_dt)||' '||getFormatTime(crt_tm))) AS crt_dttm
					, 	decode(getFormatdate(mod_dt),'','',(getFormatdate(mod_dt)||' '||getFormatTime(mod_tm))) AS mod_dttm
        			,   decode(getFormatdate(act_dt),'','',(getFormatdate(act_dt)||' '||getFormatTime(act_tm))) AS pro_dttm
					,	DECODE(CDB_REQ_GB_CD, '010100','신규','020100','수정','삭제')  AS COMM_NEW 
					,	getFormatDate(crt_dt) AS crt_dt_format
					,	getFormatTime(crt_tm) AS crt_tm_format
					, 	(SELECT USR_NM from om001 where usr_id = A.crt_usr_id) AS crt_usr_nm
					, 	getFormatDate(mod_dt) AS mod_dt_format 
					, 	getFormatTime(mod_tm) AS mod_tm_format 
					, 	mod_usr_id AS mod_usr_id 
					,	(SELECT USR_NM from om001 where usr_id = A.mod_usr_id) AS mod_usr_nm
					<!-- 
					,(SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_ex_cd AND ctg_lvl = '1')
						|| ' > ' || (SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_lg_cd AND ctg_lvl = '2') 
						|| ' > ' || (SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_md_cd AND ctg_lvl = '3')
						|| ' > ' || (SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_sm_cd AND ctg_lvl = '4')
						  -->
						,(SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_lg_cd AND ctg_lvl = '1') 
						|| ' > ' || (SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_md_cd AND ctg_lvl = '2')
						|| ' > ' || (SELECT ctg_cd_nm FROM om020 WHERE ctg_cd = A.ctg_sm_cd AND ctg_lvl = '3')
						  AS intv_nm 
					,   re_mod_req_rsn
			FROM om015 A
			WHERE REQ_ID = #{comm_id}
		</select>
		
		
		<select id="nextval" parameterType="map" resultType="map">
	        SELECT  som015.NEXTVAL req_id
	          FROM  dual
	    </select>
	    
		<insert id="jisikRewordInsert" parameterType="map">
		<selectKey resultType="string" keyProperty="Khist_ord" order="BEFORE">
       	     select NVL((select sum((select max(hist_ord) as max from oh015 where TBBS_ID= #{tbbs_id} group by tbbs_id)+1) as max
       	      from dual), 0) 
       	      from dual  
    	</selectKey>
			 {call
        		declare
       	 		begin   
      			
      			INSERT INTO om015
      			(
      					REQ_ID
      				,	TBBS_ID
      				,	USR_ID
      				,	CNTR_NM
      				,	TEAM_NM
      				,	USR_NM
      				,   ORG_ID
      				,	AFFS_ORG_USR_ID
      				,	AFFS_USR_NM
      				,   ORG_USR_ID
      				,	ORG_USR_NM      	
      				<!-- ,	CTG_EX_CD -->
      				,	CTG_LG_CD
      				,	CTG_MD_CD
      				,	CTG_SM_CD
      				,	CDB_GB_CD
      				,	REQ_CONT_C
      				,	TBBS_TTL
      				,	CDB_ACT_ST_CD
      				,	USE_YN
      				,	CDB_REQ_GB_CD
      				,	CRT_DT
      				,	CRT_TM
      				,	CRT_USR_ID
      				,	MOD_DT
      				,	MOD_TM
      				,	MOD_USR_ID
      				,	ACT_DT
      				,	ACT_TM
      			)
      			VALUES
      			(
      					#{req_id}
      				,	#{tbbs_id}
      				,	#{login_usr_id}
      				,	NVL((select cd_nm from sm002 where tp_cd = '90002' and cd = (select cntr_cd from om001 where usr_id = #{login_usr_id})),' ')
      				,	NVL((select cd_nm from sm002 where tp_cd = '90003' and cd = (select team_cd from om001 where usr_id = #{login_usr_id})),' ')
      				,	#{login_usr_nm} 
      				,   #{org_id}		
      				  <choose>
 						   <when test='ccaffir!=null and ccaffir=="Y"'>
      				,   #{affs_org_usr_id}		
      				,   NVL(NVL((select DISPLAYNAME from om061 where uid_ = #{affs_org_usr_id}),(select usr_nm from om001 where usr_id = #{affs_org_usr_id})),'')
      				,   ''
      				,   ''
  							  </when>
 						   <when test='ccaffir!=null and ccaffir!="Y"'>
    				,   (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1)
      				,   NVL(NVL((select DISPLAYNAME from om061 where uid_ = (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1)),(select usr_nm from om001 where usr_id = (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1))),'')
      				,   #{affs_org_usr_id}		
      				,   NVL(NVL((select DISPLAYNAME from om061 where uid_ = #{affs_org_usr_id}),(select usr_nm from om001 where usr_id = #{affs_org_usr_id})),'')    
    						</when>
   					 <otherwise>
   					  , ''
  					  , ''
  					  , ''
  					  , ''
  					  </otherwise>   
 				 </choose>
<!--       				<if test="ccaffir!=null and ccaffir.equals('y')">	
      				,   #{affs_org_usr_id}		
      				,   NVL(NVL((select DISPLAYNAME from om061 where uid_ = #{affs_org_usr_id}),(select usr_nm from om001 where usr_id = #{affs_org_usr_id})),'')
      				,   ''
      				,   ''
      				</if>
      				<if test="ccaffir!=null and !ccaffir.equals('y')">
      				,   (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1)
      				,   NVL(NVL((select DISPLAYNAME from om061 where uid_ = (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1)),(select usr_nm from om001 where usr_id = (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1))),'')
      				,   #{affs_org_usr_id}		
      				,   NVL(NVL((select DISPLAYNAME from om061 where uid_ = #{affs_org_usr_id}),(select usr_nm from om001 where usr_id = #{affs_org_usr_id})),'')      				
      				</if>	 -->
      				<!-- ,	#{intv_ex_cd} -->
      				,	#{intv_lg_cd}
      				,	#{intv_md_cd}
      				,	#{intv_sm_cd}
      				,	#{cdb_gb_cd}
      				,	Empty_Clob() 
					,	#{comm_ttl}
      				,	#{cdb_act_st_cd}
      				,	'Y'
      				,	#{new_yn}
      				,	to_char(sysdate, 'yyyymmdd')
      				,	to_char(sysdate, 'hh24miss')
      				,	#{login_usr_id}
      				,	to_char(sysdate, 'yyyymmdd')
      				,	to_char(sysdate, 'hh24miss')
      				,	#{login_usr_id}	
      				,	to_char(sysdate, 'yyyymmdd') 
      				,	to_char(sysdate, 'hh24miss')
      			);
      			
      			UPDATE om015
               SET REQ_CONT_C = #{comm_cntn, jdbcType = CLOB}
           	   WHERE REQ_ID = #{req_id};
             
             insert into oh015
	      			(
	      					TBBS_ID
	      				,	HIST_ORD
	      				,	USR_ID
	      				,   ORG_ID
	      				, 	TBBS_TTL
	      				, 	MOD_CONT_C
	      				,	ORG_USR_ID
	      				,	ORG_FUL_NM
	      				,	CDB_GB_CD
	      				<!-- ,	CTG_EX_CD -->
	      				,	CTG_LG_CD
	      				,	CTG_MD_CD
	      				,	CTG_SM_CD
	      				,	CDB_ACT_ST_CD
	      				,	CDB_REQ_GB_CD
	      				,  	RTN_RSN	
	      				,	USE_YN      			
	      				,	CRT_DT
	      				,	CRT_TM
	      				,	CRT_USR_ID
	      				,	MOD_DT
	      				,	MOD_TM
	      				,	MOD_USR_ID
	      			)
	      			values
	      			(
	       					#{tbbs_id}
	       				,	#{Khist_ord} 
	      				,	#{usr_id2}
	      				,   #{org_id2}		
	     				, 	#{comm_ttl}
	     				,	Empty_Clob()
	      				,	#{org_usr_id2}
	      				,	#{org_ful_nm2}
	      				,	#{cdb_gb_cd}
	      				<!-- ,	#{intv_ex_cd} -->
	      				,	#{intv_lg_cd}
	      				,	#{intv_md_cd}
	      				,	#{intv_sm_cd}
	      				,	#{cdb_act_st_cd}
	      				,	#{new_yn}
	      				,	#{rtn_rsn2}
	      				,	'Y'
	                    ,	to_char(sysdate, 'yyyymmdd')
	      				,	to_char(sysdate, 'hh24miss')
	      				,	#{login_usr_id}
	                    ,	to_char(sysdate, 'yyyymmdd')
	      				,	to_char(sysdate, 'hh24miss')
	      				,	#{login_usr_id}
	      			);
	      			
	      			UPDATE oh015
                	 		SET MOD_CONT_C = #{comm_cntn, jdbcType = CLOB}
             				WHERE TBBS_ID = #{tbbs_id}
             				and HIST_ORD = #{Khist_ord};
             				
             		<!-- <if test="tbbs_id != null and !tbbs_id.equals('')">		
             	    UPDATE om010
        					SET CC_APPR_YN = 'N'
          					where tbbs_id = #{tbbs_id};		
             		</if> -->
			 end
    	}
	</insert>
	
	<update id="updatecomment" parameterType="map">
	<selectKey resultType="string" keyProperty="Khist_ord" order="BEFORE">
       	     select NVL((select sum((select max(hist_ord) as max from oh015 where TBBS_ID= #{tbbs_id} group by tbbs_id)+1) as max
       	      from dual), 0) 
       	      from dual  
    	</selectKey>
			 {call
        		declare
       	 		begin   
					UPDATE om015
					SET 
						CTG_LG_CD = #{intv_lg_cd}
					,	CTG_MD_CD = #{intv_md_cd}
					,	CTG_SM_CD = #{intv_sm_cd}
					,	CDB_GB_CD = #{cdb_gb_cd}
					,	REQ_CONT_C = #{comm_cntn, jdbcType = CLOB}
					,	TBBS_TTL = #{comm_ttl}
					,	MOD_DT = to_char(sysdate, 'yyyymmdd')
					,	MOD_TM = to_char(sysdate, 'hh24miss')
					,	MOD_USR_ID = #{login_usr_id}
					,	CDB_REQ_GB_CD = #{new_yn}
					,	CDB_ACT_ST_CD = #{cdb_act_st_cd}
					, 	ORG_ID = #{org_id}<!-- 
					
					<if test="ccaffir != null and ccaffir.equals('Y')">	
      				,   AFFS_ORG_USR_ID = #{affs_org_usr_id}		
      				,   AFFS_USR_NM = NVL(NVL((select DISPLAYNAME from om061 where uid_ = #{affs_org_usr_id}),(select usr_nm from om001 where usr_id = #{affs_org_usr_id})),'')
      				,   ORG_USR_ID = ''
      				,   ORG_USR_NM = ''
      				</if>
      				
      				<if test="ccaffir != null and !ccaffir.equals('Y')">
      				,   AFFS_ORG_USR_ID = (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1)
      				,   AFFS_USR_NM = NVL(NVL((select DISPLAYNAME from om061 where uid_ = (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1)),(select usr_nm from om001 where usr_id = (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1))),'')
      				,   ORG_USR_ID = #{affs_org_usr_id}		
      				,   ORG_USR_NM = NVL(NVL((select DISPLAYNAME from om061 where uid_ = #{affs_org_usr_id}),(select usr_nm from om001 where usr_id = #{affs_org_usr_id})),'')      				
      				</if> -->	
      				  <choose>
 						   <when test='ccaffir!=null and ccaffir=="Y"'>
      				,   AFFS_ORG_USR_ID = #{affs_org_usr_id}		
      				,   AFFS_USR_NM = NVL(NVL((select DISPLAYNAME from om061 where uid_ = #{affs_org_usr_id}),(select usr_nm from om001 where usr_id = #{affs_org_usr_id})),'')
      				,   ORG_USR_ID = ''
      				,   ORG_USR_NM = ''
  							  </when>
 						   <when test='ccaffir!=null and ccaffir!="Y"'>
    				,   AFFS_ORG_USR_ID = (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1)
      				,   AFFS_USR_NM = NVL(NVL((select DISPLAYNAME from om061 where uid_ = (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1)),(select usr_nm from om001 where usr_id = (select uid_ from om061 where OUCODE = #{org_id} and CC_AFFAIRS_YN = 'Y' and rownum = 1))),'')
      				,   ORG_USR_ID = #{affs_org_usr_id}		
      				,   ORG_USR_NM = NVL(NVL((select DISPLAYNAME from om061 where uid_ = #{affs_org_usr_id}),(select usr_nm from om001 where usr_id = #{affs_org_usr_id})),'')        
    						</when>
   					 <otherwise>
   					,   AFFS_ORG_USR_ID= ''
      				,   AFFS_USR_NM = ''
      				,   ORG_USR_ID = ''		
      				,   ORG_USR_NM = ''      
  					  </otherwise>   
 				 </choose>
      				
			WHERE REQ_ID = #{comm_id};
			<!-- 
			UPDATE om015
               SET REQ_CONT_C = #{comm_cntn, jdbcType = CLOB}
             WHERE REQ_ID = #{req_id}; -->
             
             insert into oh015
	      			(
	      					TBBS_ID
	      				,	HIST_ORD
	      				,	USR_ID
	      				,   ORG_ID
	      				, 	TBBS_TTL
	      				, 	MOD_CONT_C
	      				,	ORG_USR_ID
	      				,	ORG_FUL_NM
	      				,	CDB_GB_CD
	      				<!-- ,	CTG_EX_CD -->
	      				,	CTG_LG_CD
	      				,	CTG_MD_CD
	      				,	CTG_SM_CD
	      				,	CDB_ACT_ST_CD
	      				,	CDB_REQ_GB_CD
	      				,  	RTN_RSN	
	      				,	USE_YN      			
	      				,	CRT_DT
	      				,	CRT_TM
	      				,	CRT_USR_ID
	      				,	MOD_DT
	      				,	MOD_TM
	      				,	MOD_USR_ID
	      			)
	      			values
	      			(
	       					#{tbbs_id}
	       				,	#{Khist_ord} 
	      				,	#{usr_id2}
	      				,   #{org_id2}
	     				, 	#{comm_ttl}
	     				,	Empty_Clob()
	      				,	#{org_usr_id2}
	      				,	#{org_ful_nm2}
	      				,	#{cdb_gb_cd}
	      				,	#{intv_lg_cd}
	      				,	#{intv_md_cd}
	      				,	#{intv_sm_cd}
	      				,	#{cdb_act_st_cd}
	      				,	#{new_yn}
	      				,	#{rtn_rsn2}
	      				,	'Y'
	                    ,	to_char(sysdate, 'yyyymmdd')
	      				,	to_char(sysdate, 'hh24miss')
	      				,	#{login_usr_id}
	                    ,	to_char(sysdate, 'yyyymmdd')
	      				,	to_char(sysdate, 'hh24miss')
	      				,	#{login_usr_id}
	      			);
	      			
	      			UPDATE oh015
                	 		SET MOD_CONT_C = #{comm_cntn, jdbcType = CLOB}
             				WHERE TBBS_ID = #{tbbs_id}
             				and HIST_ORD = #{Khist_ord};
             				
             		<if test="tbbs_id != null and !tbbs_id.equals('')">		
             	    UPDATE om010
        					SET CC_APPR_YN = 'N'
          					where tbbs_id = #{tbbs_id};		
             		</if>	
             		 end
    	}
	</update>
	
	<insert id="deptInsert" parameterType="map">
	<selectKey resultType="string" keyProperty="Khist_ord" order="BEFORE">
       	 select NVL((select sum((select max(hist_ord) as max from oh015 where TBBS_ID= #{tbbs_id} group by tbbs_id)+1) as max
       	 from dual), 0) 
       	 from dual  
    </selectKey>
	{call
		declare
		begin
		
			insert into oh015
			(
				HIST_ORD
				, TBBS_ID
				, ORG_ID
				<if test="org_usr_id != null and !org_usr_id.equals('')">
					, ORG_USR_ID
					, ORG_USR_NM
					, ORG_FUL_NM
				</if>
				, CDB_ACT_ST_CD
				, RTN_RSN
				, USE_YN
				, CRT_DT
				, CRT_TM
				, CRT_USR_ID
				, MOD_DT
				, MOD_TM
				, MOD_USR_ID
				)
			values
			(
				#{Khist_ord}
				, #{tbbs_id}
				, #{org_id}
				<if test="org_usr_id != null and !org_usr_id.equals('')">
					, #{org_usr_id}
					, NVL(NVL((SELECT DISPLAYNAME FROM OM061 WHERE UID_ = #{org_usr_id}),(select usr_nm from om001 where usr_id = #{org_usr_id})),'')
					, NVL((SELECT ORGFULLNAME FROM OM061 WHERE UID_ = #{org_usr_id}),'공주컨텍센터')
				</if>
				, #{cdb_act_st_cd}
				, #{rtn_rsn2}
				, 'Y'
				, to_char(sysdate, 'yyyymmdd')
				, to_char(sysdate, 'hh24miss')
				, NVL(NVL((SELECT DISPLAYNAME FROM OM061 WHERE UID_ = #{sendingUid}),(select usr_nm from om001 where usr_id = #{sendingUid})),'')
				, to_char(sysdate, 'yyyymmdd')
				, to_char(sysdate, 'hh24miss')
				, NVL(NVL((SELECT DISPLAYNAME FROM OM061 WHERE UID_ = #{sendingUid}),(select usr_nm from om001 where usr_id = #{sendingUid})),'')
			);
		
			UPDATE om015
						SET CDB_ACT_ST_CD = #{cdb_act_st_cd}
					 	<if test="rtn_rsn != null and !rtn_rsn.equals('')">
						,	RTN_RSN = #{rtn_rsn}
						</if>
					 	<if test="org_usr_id != null and !org_usr_id.equals('')">
						,	ORG_USR_ID = #{org_usr_id}
						, 	ORG_USR_NM = NVL(NVL((SELECT DISPLAYNAME FROM OM061 WHERE UID_ = #{org_usr_id}),(select usr_nm from om001 where usr_id = #{org_usr_id})),'')
					 	</if>
						WHERE REQ_ID = #{req_id};
						<!-- 처리상태가'신규'이고 요청이'반송'이면 해당 게시물 삭제 -->
						<if test="appn_gb_cd =='010100' and cdb_act_st_cd == '020200'">
							DELETE FROM om010
			       	        WHERE tbbs_id = #{tbbs_id};
						</if>
			
			end
		}
	</insert>


	<insert id="chargerInsert" parameterType="map">
	  <selectKey resultType="string" keyProperty="Khist_ord" order="BEFORE">
       	     select NVL((select sum((select max(hist_ord) as max from oh015 where TBBS_ID= #{tbbs_id} group by tbbs_id)+1) as max
       	      from dual), 0) 
       	      from dual  
    	</selectKey>
		{call
			declare
			begin
			
			insert into oh015
	      			(
	      					HIST_ORD
	      				,	TBBS_ID
	      				,	ORG_ID
	      				,	ORG_FUL_NM
	      				<if test="org_usr_id != null and !org_usr_id.equals('')">
	      				,	ORG_USR_ID
	      				</if>
	      				,	CDB_ACT_ST_CD
	      				,  	RTN_RSN
	      				,	USE_YN 	
	      				,	CRT_DT
	      				,	CRT_TM
	      				,	CRT_USR_ID
	      				,	MOD_DT
	      				,	MOD_TM
	      				,	MOD_USR_ID
	      			)
	      			values
	      			(
	       					#{Khist_ord} 
	       				,	#{tbbs_id}
	       				,   #{org_id}
	       				,	(select orgfullname from om060 where oucode = #{org_id})
	       				<if test="org_usr_id != null and !org_usr_id.equals('')">
	      				,	#{org_usr_id}
	      				</if>
	      				,	#{cdb_act_st_cd}
	      				,	#{rtn_rsn2}
	      				,	'Y'
	                    ,	to_char(sysdate, 'yyyymmdd')
	      				,	to_char(sysdate, 'hh24miss')
	      				,	NVL(NVL((select DISPLAYNAME from om061 where uid_ = #{org_usr_id}),(select usr_nm from om001 where usr_id = #{org_usr_id})),'')
	                    ,	to_char(sysdate, 'yyyymmdd')
	      				,	to_char(sysdate, 'hh24miss')
	      				,	NVL(NVL((select DISPLAYNAME from om061 where uid_ = #{org_usr_id}),(select usr_nm from om001 where usr_id = #{org_usr_id})),'')
	      			);
	
	
			UPDATE om015
				SET 	CDB_ACT_ST_CD = #{cdb_act_st_cd}
					 <if test="act_cont != null and act_cont != ''">
					, 	ACT_CONT=#{act_cont}
					</if>
					 <if test="rtn_rsn != null and rtn_rsn != ''">
					,	RTN_RSN = #{rtn_rsn}
					</if>
					 <if test="org_usr_id != null and org_usr_id != ''">
					,	ORG_USR_ID = #{org_usr_id}
					 </if>
					 <if test="complete != null and complete != '' and complete != 'no'">
					,	ACT_DT = to_char(sysdate, 'yyyymmdd')
					,   ACT_TM = to_char(sysdate, 'hh24miss')
					 </if>
			WHERE REQ_ID = #{req_id};
			<!-- 처리상태가'신규'이고 요청이'반송'이면 해당 게시물 삭제 -->
			<if test="cdb_req_gb_cd =='010100' and cdb_act_st_cd == '020200'">
				DELETE FROM om010
       	        WHERE tbbs_id = #{tbbs_id};
			</if>

			end
		}	
			
	</insert>	
	
	
	
		<update id="update" parameterType="map">
			UPDATE om015
			<if test="use_yn == null">
				SET 
					<!-- 	CTG_EX_CD = #{intv_ex_cd} ,-->
						CTG_LG_CD = #{intv_lg_cd}
					,	CTG_MD_CD = #{intv_md_cd}
					,	CTG_SM_CD = #{intv_sm_cd}
					,	cdb_gb_cd = #{cdb_gb_cd}
					,	REQ_CONT_C = #{comm_cntn, jdbcType = CLOB}
					,	TBBS_TTL = #{comm_ttl}	
					,	mod_dt = to_char(sysdate, 'yyyymmdd')
					,	mod_tm = to_char(sysdate, 'hh24miss')
					,	mod_usr_id = #{login_usr_id}
					<if test="new_yn != null and !new_yn.equals('all')">
					,	CDB_REQ_GB_CD = #{new_yn}
					</if>	
					
			</if>
			<if test="use_yn != null">
					SET	use_yn = #{use_yn}
					<!-- 
					<if test="intv_ex_cd != null">					
					,	CTG_EX_CD = #{intv_ex_cd}
					</if>
					 -->
					<if test="intv_lg_cd != null">	
					,	CTG_LG_CD = #{intv_lg_cd}
					</if>
					<if test="intv_md_cd != null">	
					,	CTG_MD_CD = #{intv_md_cd}
					</if>
					<if test="intv_sm_cd != null">	
					,	CTG_SM_CD = #{intv_sm_cd}
					</if>
					,	cdb_gb_cd = #{cdb_gb_cd}
					,	REQ_CONT_C = #{comm_cntn, jdbcType = CLOB}
					,	TBBS_TTL = #{comm_ttl}
					,	mod_dt = to_char(sysdate, 'yyyymmdd')
					,	mod_tm = to_char(sysdate, 'hh24miss')
					,	mod_usr_id = #{login_usr_id}
					<if test="new_yn != null and !new_yn.equals('all')">
					,	CDB_REQ_GB_CD = #{new_yn}
					</if>	
					
			</if>
			WHERE REQ_ID = #{comm_id}
	</update>
	
	<update id="save" parameterType="map">
		UPDATE om015
			SET
			<if test="tbbs_id != null">
					tbbs_id = #{tbbs_id}
			</if>
			<if test="tbbs_id == null">
					CDB_ACT_ST_CD = #{prog_knd_cd}
				<if test="resp_cntn != null">
				,	ACT_CONT = #{resp_cntn}
				</if>
				,	mod_dt = to_char(sysdate, 'yyyymmdd')
				,	mod_tm = to_char(sysdate, 'hh24miss')
				,	mod_usr_id = #{login_usr_id}
			</if>
		WHERE REQ_ID = #{comm_id}
	</update>
	
	<select id="dselectList" parameterType="map" resultType="map"> 
        <if test="rows != null and page != null">
        SELECT *
        FROM
        (
            SELECT A1.*
                ,   CEIL((ROW_NUMBER() OVER(ORDER BY ROWNUM)) / #{rows}) PAGENUM
                ,   CEIL(COUNT(1) OVER() / #{rows}) TOTPAGECOUNT
                ,   CEIL(COUNT(1) OVER()) TOTROWCOUNT
            FROM
            (
        </if>
              select
                  usr_nm as USR_NM
                  ,sum(decode(CDB_REQ_GB_CD,'Y',1,0)) as NEW_YNY
                  ,count(CDB_REQ_GB_CD) as NEW_YNALL
                  from om015
               where 1 = 1
         <if test="usr_nm != null and !usr_nm.equals('')">
             <if test="usr_nm != all and !usr_nm.equals('all')">
                AND usr_id like #{usr_nm} || '%'
             </if>
        </if>
        <if test="tbbs_strt_dt != null and !tbbs_strt_dt.equals('')">
            AND crt_dt between #{tbbs_strt_dt} and #{tbbs_end_dt}
        </if>
            group by usr_nm
        <if test="sidx != null and sord != null">
            ORDER BY ${sidx} ${sord}
        </if>
        <if test="rows != null and page != null">
            ) A1
        )
        WHERE PAGENUM = #{page}
        </if>
    </select>
</mapper>